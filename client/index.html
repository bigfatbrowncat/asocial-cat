<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Asocial Cat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>


<body>
  <div id="root">
    Loading...
    <noscript>JavaScript is required.</noscript>
  </div>

  <script type="module">
    console.log("hey!!!");

    window.process = { env: { NODE_ENV: "production" } };

    import React from "./react.js";
    import ReactDOM from "./react-dom.js";
//    import ReactDOMServer from "https://unpkg.com/es-react@latest/react-dom-server-browser.js";
    import PropTypes from "./prop-types.js";
    import Markup from "./Markup.js";
    import htm from "https://unpkg.com/htm@latest?module";

    const html = htm.bind(React.createElement);

    export {
      React,
      ReactDOM,
//      ReactDOMServer,
      PropTypes,
      Markup,
      html
    }

    var ws;
    //var messages;

    document.open_socket = function() {
      ws = new WebSocket("ws://localhost:9002/echo");
      ws.onmessage = function(evt) {
        let msg = evt.data;
        //messages.innerText = msg;

        const App = (props) => {

          //return html`<div>Hello World! foo: ${props.foo}</div>`;
          //return ReactDOMServer.renderToStaticMarkup(msg);
          return html`<${Markup} content=${props.foo} />`;
        }

        ReactDOM.render(
            html`<${App} foo=${msg} />`,
            document.getElementById("root")
        );


      };
      ws.onopen = function(evt) {
        ws.send("<em>Hello</em>");
      }
    }
    document.close_socket = function() {
      ws.close();
    }

    //document.open_socket();

  </script>
  <div><button onclick="document.open_socket();">Open socket</button><button onclick="document.close_socket();">Close socket</button></div>

</body>

</html>
