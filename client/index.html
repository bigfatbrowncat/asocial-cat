<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Asocial Cat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>


<body>
  <div id="root">
    Loading...
    <noscript>JavaScript is required.</noscript>
  </div>

  <script type="module">
    console.log("hey!!!");
    window.process = { env: { NODE_ENV: "production" } };

    import React from "./es-react/dev/react.js";
    import ReactDOM from "./es-react/dev/react-dom.js";
//    import ReactDOMServer from "https://unpkg.com/es-react@latest/react-dom-server-browser.js";
    import PropTypes from "./es-react/dev/prop-types.js";
    import htm from "./htm/dist/htm.module.js";

    import App from "./App.js";

    const html = htm.bind(React.createElement);

    export {
      React,
      ReactDOM,
      PropTypes,
      html
    }

    var ws;
    //var messages;

    window.open_socket = function() {
      ws = new WebSocket("ws://localhost:9002/echo");
      ws.onmessage = function(evt) {
        let msg = evt.data;

        ReactDOM.render(
            html`<${App} foo=${msg} />`,
            document.getElementById("root")
        );


      };
      ws.onopen = function(evt) {
        ws.send("content");
      }
    }

    window.close_socket = function() {
      ws.close();
    }

  </script>
  <div><button onclick="window.open_socket();">Open socket</button><button onclick="window.close_socket();">Close socket</button></div>

</body>

</html>
